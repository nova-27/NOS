//
// Nova27's Operating System
//
// Copyright (c) 2020 nova27
//
// This software is released under the MIT License.
// http://opensource.org/licenses/mit-license.php

#pragma once

#include "../../bootloader/includes/common.h"
#include "graphics.hpp"

#define FONT_WIDTH 8
#define FONT_HEIGHT 10
#define FONT_DISTANCE 1

// (baseX, baseY)から文字を出力するコンソールを作成します
// 使用例 :
//    Console console(&graphics, 10, 10);
//    console.setColor(color);
//    console.putchar('A');
//    console.putString("ABCDEFG");
//
// nowX, nowY は次に書き始める文字の位置を表します
// 文字の間隔は、横がFONT_DISTANCEピクセル分、縦がFONTDISTANCE*2ピクセル分です
// 画面の横からはみ出しそうになると、自動的に改行します
// 画面の縦からはみ出しそうになった時の動作は未定義です（意図しない位置にデータを書き込む可能性あり）
class Console {
 private:
    char font_bitmap_[0x7f][FONT_HEIGHT][FONT_WIDTH + 1] {
        {},  // NUL
        {},  // SOH
        {},  // STX
        {},  // ETX
        {},  // EOT
        {},  // ENQ
        {},  // ACK
        {},  // BEL
        {},  // BS
        {},  // HT
        {},  // LF
        {},  // VT
        {},  // FF
        {},  // CR
        {},  // SO
        {},  // SI
        {},  // DLE
        {},  // DC1
        {},  // DC2
        {},  // DC3
        {},  // DC4
        {},  // NAK
        {},  // SYN
        {},  // ETB
        {},  // CAN
        {},  // EM
        {},  // SUB
        {},  // ESC
        {},  // FS
        {},  // GS
        {},  // RS
        {},  // US
        {
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
        },
        {
            {"        "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"        "},
            {"   *    "},
            {"        "},
        },
        {
            {"        "},
            {"  * *   "},
            {"  * *   "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
        },
        {
            {"        "},
            {"  *  *  "},
            {"  *  *  "},
            {" ****** "},
            {"  *  *  "},
            {"  *  *  "},
            {" ****** "},
            {"  *  *  "},
            {"  *  *  "},
            {"        "},
        },
        {
            {"        "},
            {"   *    "},
            {"  ***   "},
            {" * * *  "},
            {" * *    "},
            {"  ***   "},
            {"   * *  "},
            {" * * *  "},
            {"  ***   "},
            {"   *    "},
        },
        {
            {"        "},
            {" *    * "},
            {"* *  *  "},
            {" *  *   "},
            {"    *   "},
            {"   *    "},
            {"   *  * "},
            {"  *  * *"},
            {" *    * "},
            {"        "},
        },
        {
            {"  ***   "},
            {" *   *  "},
            {" *   *  "},
            {" *   *  "},
            {"  ***   "},
            {" * *    "},
            {"*   * * "},
            {"*    ** "},
            {" *   ** "},
            {"  ***  *"},
        },
        {
            {"        "},
            {"  *     "},
            {"  *     "},
            {"  *     "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
        },
        {
            {"     *  "},
            {"    *   "},
            {"    *   "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"    *   "},
            {"    *   "},
            {"     *  "},
        },
        {
            {"  *     "},
            {"   *    "},
            {"   *    "},
            {"    *   "},
            {"    *   "},
            {"    *   "},
            {"    *   "},
            {"   *    "},
            {"   *    "},
            {"  *     "},
        },
        {
            {"        "},
            {"        "},
            {"   *    "},
            {" * * *  "},
            {"  ***   "},
            {"   *    "},
            {"  ***   "},
            {" * * *  "},
            {"   *    "},
            {"        "},
        },
        {
            {"        "},
            {"        "},
            {"        "},
            {"   *    "},
            {"   *    "},
            {" *****  "},
            {"   *    "},
            {"   *    "},
            {"        "},
            {"        "},
        },
        {
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"  *     "},
            {" *      "},
            {"        "},
        },
        {
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"  ****  "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
        },
        {
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {" **     "},
            {" **     "},
            {"        "},
        },
        {
            {"     *  "},
            {"     *  "},
            {"    *   "},
            {"    *   "},
            {"    *   "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"  *     "},
            {"  *     "},
        },
        {
            {"   **   "},
            {"  *  *  "},
            {" *    * "},
            {" *    * "},
            {" * *  * "},
            {" * *  * "},
            {" *    * "},
            {" *    * "},
            {"  *  *  "},
            {"   **   "},
        },
        {
            {"   *    "},
            {"  **    "},
            {" * *    "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {" *****  "},
        },
        {
            {"  ***   "},
            {" *   *  "},
            {"*     * "},
            {"*     * "},
            {"     *  "},
            {"    *   "},
            {"   *    "},
            {"  *     "},
            {" *      "},
            {"******* "},
        },
        {
            {"  ***   "},
            {" *   *  "},
            {"*     * "},
            {"*     * "},
            {"     *  "},
            {"  ***   "},
            {"     *  "},
            {"*     * "},
            {"*     * "},
            {" *****  "},
        },
        {
            {"    **  "},
            {"   * *  "},
            {"  *  *  "},
            {"  *  *  "},
            {" *   *  "},
            {" *   *  "},
            {" ****** "},
            {"     *  "},
            {"     *  "},
            {"     *  "},
        },
        {
            {" ****** "},
            {" *      "},
            {" *      "},
            {" *      "},
            {" *****  "},
            {"      * "},
            {"      * "},
            {"      * "},
            {" *    * "},
            {"  ****  "},
        },
        {
            {"  ***   "},
            {" *   *  "},
            {"*     * "},
            {"*       "},
            {"* ***   "},
            {"**   *  "},
            {"*     * "},
            {"*     * "},
            {" *   *  "},
            {"  ***   "},
        },
        {
            {" ****** "},
            {" *    * "},
            {" *    * "},
            {"      * "},
            {"     *  "},
            {"     *  "},
            {"    *   "},
            {"    *   "},
            {"   *    "},
            {"   *    "},
        },
        {
            {"  ****  "},
            {" *    * "},
            {" *    * "},
            {" *    * "},
            {"  ****  "},
            {" *    * "},
            {" *    * "},
            {" *    * "},
            {" *    * "},
            {"  ****  "},
        },
        {
            {"  ****  "},
            {" *    * "},
            {" *    * "},
            {" *    * "},
            {"  ***** "},
            {"      * "},
            {"     *  "},
            {"    *   "},
            {"    *   "},
            {"   *    "},
        },
        {
            {"        "},
            {"        "},
            {"   *    "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"   *    "},
            {"        "},
            {"        "},
        },
        {
            {"        "},
            {"        "},
            {"   *    "},
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"   *    "},
            {"  *     "},
            {"        "},
        },
        {
            {"        "},
            {"        "},
            {"     *  "},
            {"    *   "},
            {"   *    "},
            {"  *     "},
            {"   *    "},
            {"    *   "},
            {"     *  "},
            {"        "},
        },
        {
            {"        "},
            {"        "},
            {"        "},
            {"        "},
            {"  ****  "},
            {"        "},
            {"  ****  "},
            {"        "},
            {"        "},
            {"        "},
        },
        {
            {"        "},
            {"        "},
            {"  *     "},
            {"   *    "},
            {"    *   "},
            {"     *  "},
            {"    *   "},
            {"   *    "},
            {"  *     "},
            {"        "},
        },
        {
            {"  ****  "},
            {" *    * "},
            {"      * "},
            {"      * "},
            {"    **  "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"        "},
            {"   *    "},
        },
        {
            {"        "},
            {"  ****  "},
            {" *    * "},
            {"*  **  *"},
            {"* *  * *"},
            {"* *  * *"},
            {"*  *** *"},
            {"*    ***"},
            {" *      "},
            {"  ****  "},
        },
        {
            {"        "},
            {"        "},
            {"   **   "},
            {"   **   "},
            {"  *  *  "},
            {"  *  *  "},
            {" ****** "},
            {" *    * "},
            {" *    * "},
            {" *    * "},
        },
        {
            {"        "},
            {"  ****  "},
            {"  *   * "},
            {"  *   * "},
            {"  *   * "},
            {"  ****  "},
            {"  *   * "},
            {"  *   * "},
            {"  *   * "},
            {"  ****  "},
        },
        {
            {"        "},
            {"  ****  "},
            {" *    * "},
            {"*       "},
            {"*       "},
            {"*       "},
            {"*       "},
            {"*       "},
            {" *    * "},
            {"  ****  "},
        },
        {
            {"        "},
            {" ****   "},
            {" *   *  "},
            {" *    * "},
            {" *    * "},
            {" *    * "},
            {" *    * "},
            {" *    * "},
            {" *   *  "},
            {" ****   "},
        },
        {
            {"        "},
            {" ****** "},
            {" *      "},
            {" *      "},
            {" *      "},
            {" *****  "},
            {" *      "},
            {" *      "},
            {" *      "},
            {" *****  "},
        },
        {
            {"        "},
            {" ****** "},
            {" *      "},
            {" *      "},
            {" *      "},
            {" *****  "},
            {" *      "},
            {" *      "},
            {" *      "},
            {" *      "},
        },
        {
            {"  ***   "},
            {" *   *  "},
            {"*     * "},
            {"*       "},
            {"*       "},
            {"*   *** "},
            {"*     * "},
            {"*     * "},
            {" *   *  "},
            {"  ***   "},
        },
        {
            {"        "},
            {" *    * "},
            {" *    * "},
            {" *    * "},
            {" *    * "},
            {" ****** "},
            {" *    * "},
            {" *    * "},
            {" *    * "},
            {" *    * "},
        },
        {
            {"        "},
            {"  ***   "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"   *    "},
            {"  ***   "},
        },
        {
            {"        "},
            {"      * "},
            {"      * "},
            {"      * "},
            {"      * "},
            {"      * "},
            {"      * "},
            {"*     * "},
            {" *   *  "},
            {"  ***   "},
        },
        {
            {"        "},
            {" *    * "},
            {" *   *  "},
            {" *  *   "},
            {" * *    "},
            {" **     "},
            {" * *    "},
            {" *  *   "},
            {" *   *  "},
            {" *    * "},
        },
        {
            {"        "},
            {" *      "},
            {" *      "},
            {" *      "},
            {" *      "},
            {" *      "},
            {" *      "},
            {" *      "},
            {" *      "},
            {" *****  "},
        },
        {
            {"        "},
            {"        "},
            {"**   ** "},
            {"**   ** "},
            {"* * * * "},
            {"* * * * "},
            {"*  *  * "},
            {"*     * "},
            {"*     * "},
            {"*     * "},
        },
        {
            {"        "},
            {"**    * "},
            {"**    * "},
            {"* *   * "},
            {"* *   * "},
            {"*  *  * "},
            {"*   * * "},
            {"*   * * "},
            {"*    ** "},
            {"*    ** "},
        },
    };

    Graphics *screen_;

    const int baseX_;
    const int baseY_;

    int nowX_;
    int nowY_;

    color color_;

 public:
    // コンストラクタ
    // Graphicsクラスのオブジェクトはデストラクタが呼ばれても保持し続けます
    Console(Graphics*, int, int);
    // 文字色を設定します
    void setColor(color);
    // 一文字を出力します
    bool putchar(char);
    // 文字列を出力します
    void putString(const char*);
};
